/**
 * Copyright p5.recorder
 * v0.0.7
 * by doriclaudino <dori.claudino@gmail.com>
 * 5/2/2020
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).p5=e.p5||{},e.p5.Recorder=t())}(this,(function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function e(t,n,i){var o,a,r=window,s="application/octet-stream",d=i||s,l=t,u=!n&&!i&&l,c=document.createElement("a"),f=function(e){return String(e)},p=r.Blob||r.MozBlob||r.WebKitBlob||f,h=n||"download";if(p=p.call?p.bind(r):Blob,"true"===String(this)&&(d=(l=[l,d])[0],l=l[1]),u&&u.length<2048&&(h=u.split("/").pop().split("?")[0],c.href=u,-1!==c.href.indexOf(u))){var v=new XMLHttpRequest;return v.open("GET",u,!0),v.responseType="blob",v.onload=function(t){e(t.target.response,h,s)},setTimeout((function(){v.send()}),0),v}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(l)){if(!(l.length>2096103.424&&p!==f))return navigator.msSaveBlob?navigator.msSaveBlob(g(l),h):y(l);d=(l=g(l)).type||s}else if(/([\x80-\xff])/.test(l)){for(var w=0,b=new Uint8Array(l.length),m=b.length;w<m;++w)b[w]=l.charCodeAt(w);l=new p([b],{type:d})}function g(e){for(var t=e.split(/[:;,]/),n=t[1],i=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),o=i.length,a=0,r=new Uint8Array(o);a<o;++a)r[a]=i.charCodeAt(a);return new p([r],{type:n})}function y(e,t){if("download"in c)return c.href=e,c.setAttribute("download",h),c.className="download-js-link",c.innerHTML="downloading...",c.style.display="none",document.body.appendChild(c),setTimeout((function(){c.click(),document.body.removeChild(c),!0===t&&setTimeout((function(){r.URL.revokeObjectURL(c.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),n.src=e,setTimeout((function(){document.body.removeChild(n)}),333)}if(o=l instanceof p?l:new p([l],{type:d}),navigator.msSaveBlob)return navigator.msSaveBlob(o,h);if(r.URL)y(r.URL.createObjectURL(o),!0);else{if("string"==typeof o||o.constructor===f)try{return y("data:"+d+";base64,"+r.btoa(o))}catch(e){return y("data:"+d+","+encodeURIComponent(o))}(a=new FileReader).onload=function(e){y(this.result)},a.readAsDataURL(o)}return!0}}));function t(e,t,n,i,o,a,r){try{var s=e[a](r),d=s.value}catch(e){return void n(e)}s.done?t(d):Promise.resolve(d).then(i,o)}function n(e){return function(){var n=this,i=arguments;return new Promise((function(o,a){var r=e.apply(n,i);function s(e){t(r,o,a,s,d,"next",e)}function d(e){t(r,o,a,s,d,"throw",e)}s(void 0)}))}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}function r(e,t,n){var i=t.get(e);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(e,n);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=n}return n}function s(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var d,l=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,p=new WeakMap,h=new WeakMap,v=new WeakMap,w=new WeakMap,b=new WeakMap,m=new WeakSet,g=new WeakSet,y=new WeakSet,k=new WeakSet,O=new WeakSet,T=new WeakSet,S=new WeakMap,W=new WeakMap,M=function(){return new Blob(a(this,l))},R=function(e){r(this,h,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({canvas:document.querySelector("canvas")},a(this,p),{},e,{mimeType:"video/webm"}))},j=(d=n((function*(){var e=[],{canvas:t,fps:n,recordAudio:i}=a(this,h),o=t.captureStream(n);return e.push(o.getVideoTracks()[0]),i&&(a(this,f)&&a(this,f).active||r(this,f,yield navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0})),a(this,f).getAudioTracks().forEach(t=>e.push(t))),new MediaStream(e)})),function(){return d.apply(this,arguments)}),B=function(e){return r(this,u,new MediaRecorder(e,this.currentRecordingOptions)),a(this,u).onstop=s(this,T,P).bind(this),a(this,u).onstart=s(this,O,D).bind(this),a(this,u).ondataavailable=s(this,k,A).bind(this),a(this,u).onstop=s(this,T,P).bind(this),a(this,u).onerror=e=>console.log(e),a(this,u)},A=function(e){e.data.size&&a(this,l).push(e.data)},D=function(){r(this,v,{start:new Date,end:void 0}),r(this,w,0),r(this,l,[]),a(this,l).length=0},P=function(){a(this,v).end=new Date,r(this,w,100),a(this,c)&&this.download()},U=function(){var e,t,n,i;return((null===(e=a(this,v))||void 0===e||null===(t=e.end)||void 0===t?void 0:t.getTime())||(new Date).getTime())-(null===(n=a(this,v))||void 0===n||null===(i=n.start)||void 0===i?void 0:i.getTime())||void 0},x=function(){return a(this,S)*a(this,h).fps/1e3||0};return class{constructor(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];W.set(this,{get:x,set:void 0}),S.set(this,{get:U,set:void 0}),T.add(this),O.add(this),k.add(this),y.add(this),g.add(this),m.add(this),b.set(this,{get:M,set:void 0}),l.set(this,{writable:!0,value:[]}),u.set(this,{writable:!0,value:void 0}),c.set(this,{writable:!0,value:!0}),f.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:{filename:"p5.recorder.canvas.webm",recordAudio:!0,audioBitRate:128e3,videoBitRate:12e7,fps:60}}),h.set(this,{writable:!0,value:{canvas:void 0,filename:void 0,recordAudio:void 0,audioBitRate:void 0,videoBitRate:void 0,fps:void 0,mimeType:void 0}}),v.set(this,{writable:!0,value:{start:void 0,end:void 0}}),w.set(this,{writable:!0,value:0}),r(this,c,e)}start(e){var t=this;return n((function*(){s(t,m,R).call(t,e);var n=yield s(t,g,j).call(t);s(t,y,B).call(t,n),a(t,u).start()}))()}download(){e(a(this,b),a(this,h).filename,a(this,h).mimeType)}stop(){a(this,u).stop()}get status(){var e;return{state:null===(e=a(this,u))||void 0===e?void 0:e.state,time:a(this,S),frames:a(this,W),progress:a(this,w)}}}}));
//# sourceMappingURL=p5.recorder.min.js.map
